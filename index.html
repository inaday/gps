<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <title>使用高德地图API获得定位</title>
  <script src="https://webapi.amap.com/maps?v=1.4.15&key=c201351dc0d51a0875735a437be547f4"></script>
  <style>
    #status {
      font-size: 1.2em;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>使用高德地图API获得定位</h1>
  <p>页面已打开，正在获取位置信息……</p>
  <p id="status"></p>
  <p>纬度：<span id="latitude"></span></p>
  <p>经度：<span id="longitude"></span></p>
  <p>地址：<span id="address"></span></p>

  <script>
    var map, geolocation;

    // 加载地图，初始化定位对象
    map = new AMap.Map('container');
    map.plugin('AMap.Geolocation', function() {
      geolocation = new AMap.Geolocation({
        enableHighAccuracy: true, // 是否使用高精度定位，默认为true
        timeout: 10000, // 超过10秒后停止定位，默认为无穷大
        buttonOffset: new AMap.Pixel(10, 20), // 定位按钮与设置的停靠位置的偏移量，默认为Pixel(10, 20)
        zoomToAccuracy: true, // 定位成功后是否自动调整地图视野到定位点
        buttonPosition: 'RB'
      });
      map.addControl(geolocation);
      geolocation.getCurrentPosition();
      AMap.event.addListener(geolocation, 'complete', onComplete); // 定位完成事件
      AMap.event.addListener(geolocation, 'error', onError); // 定位失败事件
    });

    // 定位成功后的回调函数
    function onComplete(data) {
      var latitude = data.position.lat;
      var longitude = data.position.lng;
      var address = data.formattedAddress;

      // 显示位置信息
      $("#latitude").text(latitude);
      $("#longitude").text(longitude);
      $("#address").text(address);
      $("#status").text("获取位置信息成功。");
    }

    // 定位失败后的回调函数
    function onError(error) {
      var errorText = '';
      switch (error.info) {
        case 'PERMISSION_DENIED':
          errorText = '用户拒绝了定位请求。';
          break;
        case 'POSITION_UNAVAILABLE':
          errorText = '位置信息不可用。';
          break;
        case 'TIMEOUT':
          errorText = '请求超时。';
          break;
        case 'UNKNOWN_ERROR':
          errorText = '发生未知错误。';
          break;
      }
      $("#status").text(errorText);
    }
  </script>

</body>
</html>
